"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),VinCode=function(){function e(){_classCallCheck(this,e),this.validate=!1,this.code=null,this.date=[],this.results="",this.events(),this.disableBtn(),localStorage.getItem("data")&&(this.date=JSON.parse(localStorage.getItem("data")))}return _createClass(e,[{key:"events",value:function(){var e=this;document.querySelector("form").addEventListener("submit",function(t){t.preventDefault(),e.onSubmit()}),document.querySelector("#vinInput").addEventListener("input",function(t){e.onInput(t)}),window.addEventListener("offline",function(e){alert("Интернет отключен, данные только из кеша!")}),window.addEventListener("online",function(e){alert("Мы в сети!!! )")})}},{key:"sortTable",value:function(e){var t,n,a,i,r,o,s,l,u=0;for(t=document.querySelector("#table"),a=!0,l="asc";a;){for(a=!1,n=t.getElementsByTagName("TR"),i=1;i<n.length-1;i++)if(s=!1,r=n[i].getElementsByTagName("TD")[e],o=n[i+1].getElementsByTagName("TD")[e],"asc"==l){if(r.innerHTML.toLowerCase()>o.innerHTML.toLowerCase()){s=!0;break}}else if("desc"==l&&r.innerHTML.toLowerCase()<o.innerHTML.toLowerCase()){s=!0;break}s?(n[i].parentNode.insertBefore(n[i+1],n[i]),a=!0,u++):0==u&&"asc"==l&&(l="desc",a=!0)}}},{key:"saveToLS",value:function(){var e={id:this.code,array:this.results};this.date.push(e),localStorage.setItem("data",JSON.stringify(this.date))}},{key:"onInput",value:function(e){this.code=e.target.value,this.validate=this.validateVin(e.target.value),this.disableBtn()}},{key:"onSubmit",value:function(){for(var e=this,t=!1,n=0;n<this.date.length;n++)this.date[n].id==this.code&&(t=!0,this.results=this.date[n].array,this.showInTable(this.date[n].array));t||fetch("https://vpic.nhtsa.dot.gov/api/vehicles/decodevinextended/"+this.code+"?format=json").then(function(e){return e.json()}).then(function(t){e.results=t.Results,e.showInTable(t.Results),e.saveToLS()})["catch"](function(e){console.log(e)})}},{key:"disableBtn",value:function(){document.querySelector("#vinSubmit").disabled=!this.validate}},{key:"showInTable",value:function(e){[].forEach.call(document.querySelectorAll(".car"),function(e){e.parentNode.removeChild(e)});for(var t=document.querySelector("table"),n=0;n<e.length;n++){var a=document.createElement("tr");a.classList="car",a.innerHTML="<td>"+e[n].Variable+"</td><td>"+(e[n].Value?e[n].Value:"данных нет")+"</td>",t.appendChild(a)}}},{key:"validateVin",value:function(e){function t(e){return"0123456789.ABCDEFGH..JKLMN.P.R..STUVWXYZ".indexOf(e)%10}function n(e){for(var n="0123456789X",a="8765432X098765432",i=0,r=0;17>r;++r)i+=t(e[r])*n.indexOf(a[r]);return n[i%11]}function a(e){return 17!==e.length?!1:n(e)===e[8]}return a(e)}}]),e}(),vin=new VinCode;